<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Walkthrough: Benchmarking a series of builds</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="4b0b00d6-f9a1-4eae-b880-892eb0d513fb" /><meta name="Description" content="This walkthrough explains how to benchmark multiple builds of Brimstone stored in consecutive repository commits." /><meta name="Microsoft.Help.ContentType" content="How To" /><meta name="BrandingAware" content="true" /><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Hearthstone Working Group<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="bbd3d95b-45e3-46e9-bd51-35ee4749d7b6.htm" title="Hearthstone Working Group" tocid="roottoc">Hearthstone Working Group</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="bbd3d95b-45e3-46e9-bd51-35ee4749d7b6.htm" title="Brimstone Developer Documentation" tocid="bbd3d95b-45e3-46e9-bd51-35ee4749d7b6">Brimstone Developer Documentation</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="3867a7e4-21e2-4e3b-934b-c1c4ae15efa9.htm" title="Benchmarks and Profiling" tocid="3867a7e4-21e2-4e3b-934b-c1c4ae15efa9">Benchmarks and Profiling</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="f230a982-28b6-4fd1-b0ce-c3decd883ab4.htm" title="Walkthrough: Benchmarking a single build" tocid="f230a982-28b6-4fd1-b0ce-c3decd883ab4">Walkthrough: Benchmarking a single build</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="4b0b00d6-f9a1-4eae-b880-892eb0d513fb.htm" title="Walkthrough: Benchmarking a series of builds" tocid="4b0b00d6-f9a1-4eae-b880-892eb0d513fb">Walkthrough: Benchmarking a series of builds</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="c5beb99b-5b2f-4287-b2e8-c787a10399eb.htm" title="Walkthrough: Creating new benchmarks" tocid="c5beb99b-5b2f-4287-b2e8-c787a10399eb">Walkthrough: Creating new benchmarks</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="8d25a5f6-350d-4ebb-9a3b-1cb6a60cf573.htm" title="Walkthrough: Code profiling in Visual Studio" tocid="8d25a5f6-350d-4ebb-9a3b-1cb6a60cf573">Walkthrough: Code profiling in Visual Studio</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="logoColumn"><img alt="HearthSim" width="64" height="64" src="../icons/HearthSim.png" /></td><td class="titleColumn">Walkthrough: Benchmarking a series of builds</td></tr></table><span class="introStyle"></span> <p style="color: #dc143c; font-size: 8.5pt; font-weight: bold;">[This is preliminary documentation and is subject to change.]</p><div class="summary"><p>This walkthrough explains how to benchmark multiple builds of Brimstone stored in consecutive repository commits.</p></div><div class="introduction"><div class="alert"><table><tr><th><img src="../icons/AlertCaution.png" alt="Important note" /> Important</th></tr><tr><td><p>
          Multi-commit benchmarking uses MSBuild to re-compile <span class="code">benchmarks.exe</span> for each build and is not compatible with Mono.
        </p></td></tr></table></div><p>
        Brimstone provides the <span class="code">profiler.exe</span> command-line tool to run the same benchmarks across multiple commits. It works as follows:
      </p><ol><li><p>
            For each commit to benchmark, the commit is checked out in a detached HEAD state, its NuGet packages are restored, the Brimstone library is built from the checked out solution and the <strong>Benchmarks</strong> project is built using the newly compiled library as the reference to <span class="code">Brimstone.dll</span>.
          </p></li><li><p><span class="code">benchmarks.exe</span> is run for the commit
          </p></li><li><p>
            The <span class="code">benchmarks.csv</span> output file is parsed and stored
          </p></li><li><p>
            When all of the commits have been benchmarked, the results for every commit are written to a table in <span class="code">profiler.csv</span></p></li></ol></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID0RB')" onkeypress="SectionExpandCollapse_CheckKey('ID0RB', event)" tabindex="0"><img id="ID0RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Prerequisites</span></div><div id="ID0RBSection" class="collapsibleSection"><p>
          To benchmark a series of builds, you will need a basic understanding of <strong>git</strong>.
        </p><p>
          Ensure you have built <strong>BrimstoneProfiler</strong> as explained in <a href="3867a7e4-21e2-4e3b-934b-c1c4ae15efa9.htm">Benchmarks and Profiling</a> before you begin. For multi-build benchmarking, you only need to build the <strong>Profiler</strong> project, and the version of <span class="code">Brimstone.dll</span> referenced in the <strong>Benchmarks</strong> project does not matter.
        </p><div class="alert"><table><tr><th><img src="../icons/AlertCaution.png" alt="Important note" /> Important</th></tr><tr><td><p>
            For multi-build benchmarking to work, the <strong>Brimstone</strong> and <strong>BrimstoneProfiler</strong> folders must be placed together in the same parent folder.
          </p></td></tr></table></div><div class="alert"><table><tr><th><img src="../icons/AlertCaution.png" alt="Caution note" /> Caution</th></tr><tr><td><p>
            Ensure you have no uncommitted changes to your <strong>Brimstone</strong> repository folder before running multi-build benchmarks. Running the benchmark suite checks out different commits in your repository folder. If you have uncommitted changes, they may be overwritten or the benchmark suite may fail to work correctly. When the benchmark suite finishes running, check out the commit you were originally working on again.
          </p></td></tr></table></div><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Tip" /> Tip</th></tr><tr><td><p>
            You can save unstaged or uncommitted changes to your working folder without making a commit by typing <span class="code">git stash</span> at the command prompt. This will save them in the git stash and return your working folder to the state it was in when you checked out the branch. Type <span class="code">git stash pop</span> to restore your changes.
          </p></td></tr></table></div></div><h3 class="procedureSubHeading">To benchmark multiple builds of Brimstone together</h3><div class="subSection"><ol><li><p>
              Open a command prompt from which to run the benchmarks and navigate to the folder containing the compiled <span class="code">profiler.exe</span> tool.
            </p></li><li><p>
              Select a range of commits to benchmark. You can view the commit IDs for the current branch by typing <span class="code">git log --oneline</span>. The commit IDs are shown as 7-digit (or longer) hexadecimal numbers.
            </p></li><li><p>
              Start the benchmarks by typing <span class="code">profiler --commit-range=oldest-commit-id,newest-commit-id</span>. If you omit <span class="code">newest-commit-id</span>, benchmarks will run from the specified commit up to and including the most recent commit on the current branch. The default settings for <span class="code">benchmarks.exe</span> will be used for each run.
            </p></li><li><p>
              When the benchmarks have finished running, the output can be found in CSV format in <span class="code">profiler.csv</span> in the working folder.
            </p></li></ol></div><h3 class="procedureSubHeading">To specify benchmarking options for each build</h3><div class="subSection"><ul><li><p>
              You can use all of the benchmarking options that would be passed to <span class="code">benchmarks.exe</span> as described in <a href="f230a982-28b6-4fd1-b0ce-c3decd883ab4.htm">Walkthrough: Benchmarking a single build</a> as options to <span class="code">profiler.exe</span>. These options will be applied to every build when the benchmarks are run.
            </p><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Note" /> Note</th></tr><tr><td><p>
                If you specify more than one run for each individual benchmark using multiple <span class="code">--unset</span> options, all but the first will be ignored when aggregating the results - the rest will be ignored.
              </p></td></tr></table></div></li></ul></div><h3 class="procedureSubHeading">To view compiler output when building each commit</h3><div class="subSection"><ul><li><p>
              In the event that building fails, you can check the compiler output by using the <span class="code">--compiler-output</span> flag. Note that this produces a lot of output.
            </p></li></ul></div><h3 class="procedureSubHeading">To change the search path for the Brimstone solution files</h3><div class="subSection"><ul><li><p>
              By default, the current directory and all parent directories are searched for the <span class="code">Brimstone</span> and <span class="code">BrimstoneProfiler</span> solution folders. To specify a different path, use the <span class="code">--base-path</span> option.
            </p></li></ul></div><h3 class="procedureSubHeading">To import benchmarks as an Excel chart</h3><div class="subSection"><ol><li><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Note" /> Note</th></tr><tr><td><p>This instructions are for Excel 2016 but should work all versions from Excel 2010 and later.</p></td></tr></table></div><p>
              Open Excel and drag <span class="code">profiler.csv</span> into it.
            </p></li><li><p>
              Drag a box around the table including the header but excluding the build line, and press <strong>CTRL+T</strong> or choose <strong>Insert -&gt; Table</strong> from the ribbon bar. Tick <strong>My table has headers</strong> and click OK.
            </p><div class="mediaNear"><img alt="Excel Benchmarks Multi Insert Table" src="../media/ExcelBenchmarksMultiInsertTable.png" /></div></li><li><p>
              Click <strong>Insert -&gt; Recommended Charts</strong> from the ribbon bar and choose the desired chart type. For unrelated benchmarks, <strong>Clustered Bar</strong> and <strong>Clustered Column</strong> are generally the best options. If you ran a single benchmark across multiple builds, the <strong>Line</strong> chart shows performance improvement and degradation across each build.
            </p><div class="mediaNear"><img alt="Excel Benchmarks Multi Insert Chart" src="../media/ExcelBenchmarksMultiInsertChart.png" /></div><div class="mediaNear"><img alt="Excel Benchmarks Multi Single Insert Chart" src="../media/ExcelBenchmarksMultiSingleInsertChart.png" /></div></li><li><p>
              You can easily style the chart by selecting <strong>Design</strong> from the ribbon and clicking on one of the pre-defined chart styles.
            </p><div class="mediaNear"><img alt="Excel Benchmarks Multi Style Chart" src="../media/ExcelBenchmarksMultiStyleChart.png" /></div></li></ol></div><div class="collapsibleAreaRegion" id="seeAlsoSection"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />See Also</span></div><div id="ID1RBSection" class="collapsibleSection"><h4 class="subHeading">Reference</h4><div class="seeAlsoStyle"><a href="cd5363d1-f7d0-3cf8-36a7-bd25916dc8c9.htm">Brimstone<span id="LSTE12FA4A4_0"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTE12FA4A4_0?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>Settings</a></div><h4 class="subHeading">Other Resources</h4><div class="seeAlsoStyle"><a href="3867a7e4-21e2-4e3b-934b-c1c4ae15efa9.htm">Benchmarks and Profiling</a></div><div class="seeAlsoStyle"><a href="f230a982-28b6-4fd1-b0ce-c3decd883ab4.htm">Walkthrough: Benchmarking a single build</a></div><div class="seeAlsoStyle"><a href="c5beb99b-5b2f-4287-b2e8-c787a10399eb.htm">Walkthrough: Creating new benchmarks</a></div><div class="seeAlsoStyle"><a href="8d25a5f6-350d-4ebb-9a3b-1cb6a60cf573.htm">Walkthrough: Code profiling in Visual Studio</a></div><div class="seeAlsoStyle"><a href="https://github.com/HearthSim/BrimstoneProfiler" target="_blank">BrimstoneProfiler repository homepage</a></div></div></div></div><div id="pageFooter" class="pageFooter"><a href="http://discord.me/hearthstoneworkinggroup">Join us on Discord</a><br /><p>Hearthstone Working Group 2016 - Part of HearthSim.info</p></div></body></html>