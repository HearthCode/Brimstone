<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Walkthrough: Benchmarking a single build</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="f230a982-28b6-4fd1-b0ce-c3decd883ab4" /><meta name="Description" content="This walkthrough explains how to benchmark a single build of Brimstone." /><meta name="Microsoft.Help.ContentType" content="How To" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Hearthstone Working Group<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="bbd3d95b-45e3-46e9-bd51-35ee4749d7b6.htm" title="Hearthstone Working Group" tocid="roottoc">Hearthstone Working Group</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="bbd3d95b-45e3-46e9-bd51-35ee4749d7b6.htm" title="Brimstone Developer Documentation" tocid="bbd3d95b-45e3-46e9-bd51-35ee4749d7b6">Brimstone Developer Documentation</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="3867a7e4-21e2-4e3b-934b-c1c4ae15efa9.htm" title="Benchmarks and Profiling" tocid="3867a7e4-21e2-4e3b-934b-c1c4ae15efa9">Benchmarks and Profiling</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="f230a982-28b6-4fd1-b0ce-c3decd883ab4.htm" title="Walkthrough: Benchmarking a single build" tocid="f230a982-28b6-4fd1-b0ce-c3decd883ab4">Walkthrough: Benchmarking a single build</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="4b0b00d6-f9a1-4eae-b880-892eb0d513fb.htm" title="Walkthrough: Benchmarking a series of builds" tocid="4b0b00d6-f9a1-4eae-b880-892eb0d513fb">Walkthrough: Benchmarking a series of builds</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="c5beb99b-5b2f-4287-b2e8-c787a10399eb.htm" title="Walkthrough: Creating new benchmarks" tocid="c5beb99b-5b2f-4287-b2e8-c787a10399eb">Walkthrough: Creating new benchmarks</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="8d25a5f6-350d-4ebb-9a3b-1cb6a60cf573.htm" title="Walkthrough: Code profiling in Visual Studio" tocid="8d25a5f6-350d-4ebb-9a3b-1cb6a60cf573">Walkthrough: Code profiling in Visual Studio</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="logoColumn"><img alt="HearthSim" width="64" height="64" src="../icons/HearthSim.png" /></td><td class="titleColumn">Walkthrough: Benchmarking a single build</td></tr></table><span class="introStyle"></span> <p style="color: #dc143c; font-size: 8.5pt; font-weight: bold;">[This is preliminary documentation and is subject to change.]</p><div class="summary"><p>This walkthrough explains how to benchmark a single build of Brimstone.</p></div><div class="introduction"><p>These instructions are for Visual Studio on Windows but can be adapted for Mono/Linux.</p><p>In this section:</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#filters">To run a selected subset of benchmarks</a></li><li class="outlineSectionEntry"><a href="#settings">To run the benchmarks with different settings</a></li><li class="outlineSectionEntry"><a href="#sets">To run benchmarks multiple times with different settings for each run</a></li><li class="outlineSectionEntry"><a href="#timeout">To set a timeout on benchmark runs</a></li><li class="outlineSectionEntry"><a href="#charting">To import benchmarks as an Excel chart</a></li><li class="outlineSectionEntry"><a href="#seeAlsoSection">See Also</a></li></ul></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID0RB')" onkeypress="SectionExpandCollapse_CheckKey('ID0RB', event)" tabindex="0"><img id="ID0RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Prerequisites</span></div><div id="ID0RBSection" class="collapsibleSection"><p>
          The <strong>BrimstoneProfiler</strong> repository contains the tools required to benchmark Brimstone applications. You must have a clone of this repository present on your local machine to run benchmarks.
        </p></div><h3 class="procedureSubHeading">To benchmark a single build of Brimstone</h3><div class="subSection"><ol><li><p>
              Clone the <a href="https://github.com/HearthSim/BrimstoneProfiler" target="_blank">BrimstoneProfiler</a> repository.
            </p></li><li><p>
              In the <strong>References</strong> section of the <strong>Benchmarks</strong> project, modify the Brimstone reference to point to the build of Brimstone you wish to benchmark. Once you have done this, build the solution.
            </p><div class="alert"><table><tr><th><img src="../icons/AlertCaution.png" alt="Important note" /> Important</th></tr><tr><td><p>
                Always build the solution in Release configuration and always reference a Release build of Brimstone.dll.
              </p></td></tr></table></div></li><li><p>
              Open a command prompt from which to run the benchmarks and navigate to the folder containing the compiled <span class="code">benchmarks.exe</span> tool.
            </p><div class="alert"><table><tr><th><img src="../icons/AlertCaution.png" alt="Important note" /> Important</th></tr><tr><td><p>
                Always run <span class="code">benchmarks.exe</span> from the command prompt to ensure accurate results. Running via Visual Studio - even with debugging disabled - starts a host process for the application which will affect the results.
              </p></td></tr></table></div></li><li><p>
              To run all of the benchmarks with all optimizations enabled, type <span class="code">benchmarks</span> and press Enter. The benchmarks may take several minutes to complete. The output window will show the current progress.
            </p><div class="alert"><table><tr><th><img src="../icons/AlertCaution.png" alt="Important note" /> Important</th></tr><tr><td><p>
                Always run benchmarks on a machine with low CPU utilization. Use <strong>Task Manager</strong> to check the current CPU usage on your machine before running benchmarks.
              </p><p>
                Brimstone's published test results are performed with 6-8% background CPU utilization.
              </p></td></tr></table></div><div class="alert"><table><tr><th><img src="../icons/AlertCaution.png" alt="Important note" /> Important</th></tr><tr><td><p>
                The first time you run the benchmarks after building, you may experience slower than expected results. This is because the .NET CLR performs JIT compilation on the first run. For more accurate results, run the benchmarks a second time after compiling.
              </p></td></tr></table></div></li><li><p>
              When the benchmarks have finished running, the output can be found in CSV format in <span class="code">benchmarks.csv</span> in the working folder.
            </p></li></ol></div><div class="collapsibleAreaRegion" id="filters"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />To run a selected subset of benchmarks</span></div><div id="ID2RBSection" class="collapsibleSection"><p>
          The short test names (those shown in square brackets at the start of each benchmark run) can be filtered on to run a subset of benchmarks. Use the <span class="code">--filter</span> argument with a regular expression to specify a filter, for example:
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EABAFAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EABAFAAA');return false;" title="Copy">Copy</a></div></div><div id="ID1EABAFAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">benchmarks --filter=Arcane.*BFS</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EABAFAAA");</script><p>This will cause only the Arcane Missiles breadth-first search tests to run.</p></div><div class="collapsibleAreaRegion" id="settings"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />To run the benchmarks with different settings</span></div><div id="ID3RBSection" class="collapsibleSection"><p>
          By default, all optimizations are enabled. To disable one or more optimizations, use the <span class="code">--unset</span> argument with a comma-separated list of settings to disable, for example:
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EACAEAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EACAEAAA');return false;" title="Copy">Copy</a></div></div><div id="ID1EACAEAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">benchmarks --unset=ParallelClone,ZoneCaching</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EACAEAAA");</script><p>This will run the benchmarks with parallel cloning and zone caching disabled.</p><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Tip" /> Tip</th></tr><tr><td><p>
            For a full list of available settings, see <a href="cd5363d1-f7d0-3cf8-36a7-bd25916dc8c9.htm">Brimstone<span id="LST549CB90A_0"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST549CB90A_0?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>Settings</a>.
          </p></td></tr></table></div></div><div class="collapsibleAreaRegion" id="sets"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID4RB')" onkeypress="SectionExpandCollapse_CheckKey('ID4RB', event)" tabindex="0"><img id="ID4RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />To run benchmarks multiple times with different settings for each run</span></div><div id="ID4RBSection" class="collapsibleSection"><p>
          You can specify the <span class="code">--unset</span> parameter multiple times. This will cause each test to run once for each specification, with the selected optimizations disabled. For example:
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EACADAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EACADAAA');return false;" title="Copy">Copy</a></div></div><div id="ID1EACADAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">benchmarks --unset=ParallelClone --unset=ParallelClone,ZoneCaching</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EACADAAA");</script><p>
          This will run each benchmark twice - once with parallel cloning disabled, and once with parallel cloning and zone caching disabled.
        </p><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Tip" /> Tip</th></tr><tr><td><p>
            To make one of the benchmark sets run with all optimizations enabled, use <span class="code">--unset</span> with no arguments as one of the sets.
          </p></td></tr></table></div></div><div class="collapsibleAreaRegion" id="timeout"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID5RB')" onkeypress="SectionExpandCollapse_CheckKey('ID5RB', event)" tabindex="0"><img id="ID5RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />To set a timeout on benchmark runs</span></div><div id="ID5RBSection" class="collapsibleSection"><p>
          You can specify a timeout after which a benchmark will give up with the <span class="code">--timeout</span> parameter. Specify the timeout in milliseconds.
        </p><p>
          Timeouts are disabled by default.
        </p><div class="alert"><table><tr><th><img src="../icons/AlertCaution.png" alt="Caution note" /> Caution</th></tr><tr><td><p>Setting a timeout creates a background thread to monitor elapsed time and creates an 8-12% negative impact on benchmark performance results. Only use a timeout when you suspect a test is malfunctioning and don't want the benchmark to hang indefinitely.</p></td></tr></table></div></div><div class="collapsibleAreaRegion" id="charting"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID6RB')" onkeypress="SectionExpandCollapse_CheckKey('ID6RB', event)" tabindex="0"><img id="ID6RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />To import benchmarks as an Excel chart</span></div><div id="ID6RBSection" class="collapsibleSection"><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Note" /> Note</th></tr><tr><td><p>This instructions are for Excel 2016 but should work all versions from Excel 2010 and later.</p></td></tr></table></div><ol><li><p>
              Open Excel and drag <span class="code">benchmarks.csv</span> into it.
            </p></li><li><p>
              Drag a box around the table including the header but excluding the build line, and press <strong>CTRL+T</strong> or choose <strong>Insert -&gt; Table</strong> from the ribbon bar. Tick <strong>My table has headers</strong> and click OK.
            </p><div class="mediaNear"><div class="caption">Excel Benchmarks Insert Table</div><img alt="Excel Benchmarks Insert Table" src="../media/ExcelBenchmarksInsertTable.png" /></div></li><li><p>
              Click <strong>Insert -&gt; Recommended Charts</strong> from the ribbon bar and choose the desired chart type. For unrelated benchmarks, <strong>Clustered Column</strong> is generally the best option. If the benchmarks are related, a <strong>Line</strong> chart shows performance improvement and degradation across each test.
            </p><div class="mediaNear"><div class="caption">Excel Benchmarks Insert Chart</div><img alt="Excel Benchmarks Insert Chart" src="../media/ExcelBenchmarksInsertChart.png" /></div><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Tip" /> Tip</th></tr><tr><td><p>
                You can easily style the chart by selecting <strong>Design</strong> from the ribbon and clicking on one of the pre-defined chart styles.
              </p></td></tr></table></div><div class="mediaNear"><div class="caption">Excel Benchmarks Style Chart</div><img alt="Excel Benchmarks Style Chart" src="../media/ExcelBenchmarksStyleChart.png" /></div></li></ol></div><div class="collapsibleAreaRegion" id="seeAlsoSection"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID7RB')" onkeypress="SectionExpandCollapse_CheckKey('ID7RB', event)" tabindex="0"><img id="ID7RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />See Also</span></div><div id="ID7RBSection" class="collapsibleSection"><h4 class="subHeading">Reference</h4><div class="seeAlsoStyle"><a href="cd5363d1-f7d0-3cf8-36a7-bd25916dc8c9.htm">Brimstone<span id="LST549CB90A_1"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST549CB90A_1?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>Settings</a></div><h4 class="subHeading">Other Resources</h4><div class="seeAlsoStyle"><a href="3867a7e4-21e2-4e3b-934b-c1c4ae15efa9.htm">Benchmarks and Profiling</a></div><div class="seeAlsoStyle"><a href="4b0b00d6-f9a1-4eae-b880-892eb0d513fb.htm">Walkthrough: Benchmarking a series of builds</a></div><div class="seeAlsoStyle"><a href="c5beb99b-5b2f-4287-b2e8-c787a10399eb.htm">Walkthrough: Creating new benchmarks</a></div><div class="seeAlsoStyle"><a href="8d25a5f6-350d-4ebb-9a3b-1cb6a60cf573.htm">Walkthrough: Code profiling in Visual Studio</a></div><div class="seeAlsoStyle"><a href="https://github.com/HearthSim/BrimstoneProfiler" target="_blank">BrimstoneProfiler repository homepage</a></div></div></div></div><div id="pageFooter" class="pageFooter"><a href="http://discord.me/hearthstoneworkinggroup">Join us on Discord</a><br /><p>Hearthstone Working Group 2016 - Part of HearthSim.info</p></div></body></html>