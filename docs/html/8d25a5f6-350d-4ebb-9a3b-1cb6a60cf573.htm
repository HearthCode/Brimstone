<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Walkthrough: Code profiling in Visual Studio</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="8d25a5f6-350d-4ebb-9a3b-1cb6a60cf573" /><meta name="Description" content="This walkthrough explains how to profile Brimstone code using Visual Studio Code Analysis on Windows." /><meta name="Microsoft.Help.ContentType" content="How To" /><meta name="BrandingAware" content="true" /><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Hearthstone Working Group<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="bbd3d95b-45e3-46e9-bd51-35ee4749d7b6.htm" title="Hearthstone Working Group" tocid="roottoc">Hearthstone Working Group</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="bbd3d95b-45e3-46e9-bd51-35ee4749d7b6.htm" title="Brimstone Developer Documentation" tocid="bbd3d95b-45e3-46e9-bd51-35ee4749d7b6">Brimstone Developer Documentation</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="3867a7e4-21e2-4e3b-934b-c1c4ae15efa9.htm" title="Benchmarks and Profiling" tocid="3867a7e4-21e2-4e3b-934b-c1c4ae15efa9">Benchmarks and Profiling</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="f230a982-28b6-4fd1-b0ce-c3decd883ab4.htm" title="Walkthrough: Benchmarking a single build" tocid="f230a982-28b6-4fd1-b0ce-c3decd883ab4">Walkthrough: Benchmarking a single build</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="4b0b00d6-f9a1-4eae-b880-892eb0d513fb.htm" title="Walkthrough: Benchmarking a series of builds" tocid="4b0b00d6-f9a1-4eae-b880-892eb0d513fb">Walkthrough: Benchmarking a series of builds</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="c5beb99b-5b2f-4287-b2e8-c787a10399eb.htm" title="Walkthrough: Creating new benchmarks" tocid="c5beb99b-5b2f-4287-b2e8-c787a10399eb">Walkthrough: Creating new benchmarks</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="8d25a5f6-350d-4ebb-9a3b-1cb6a60cf573.htm" title="Walkthrough: Code profiling in Visual Studio" tocid="8d25a5f6-350d-4ebb-9a3b-1cb6a60cf573">Walkthrough: Code profiling in Visual Studio</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="logoColumn"><img alt="HearthSim" width="64" height="64" src="../icons/HearthSim.png" /></td><td class="titleColumn">Walkthrough: Code profiling in Visual Studio</td></tr></table><span class="introStyle"></span> <p style="color: #dc143c; font-size: 8.5pt; font-weight: bold;">[This is preliminary documentation and is subject to change.]</p><div class="summary"><p>This walkthrough explains how to profile Brimstone code using Visual Studio Code Analysis on Windows.</p></div><div class="introduction" /><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID0RB')" onkeypress="SectionExpandCollapse_CheckKey('ID0RB', event)" tabindex="0"><img id="ID0RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Prerequisites</span></div><div id="ID0RBSection" class="collapsibleSection"><p>
          This guide was written for Visual Studio 2015, but should be compatible with any other version of Visual Studio providing Code Analysis.
        </p></div><h3 class="procedureSubHeading">To profile Brimstone or a Brimstone application</h3><div class="subSection"><ol><li><p>
              Right-click the project you would like to run in <strong>Solution Explorer</strong> and choose <strong>Set as StartUp Project</strong>. Ensure you are in <strong>Release</strong> build configuration.
            </p></li><li><p>
              Press <strong>Alt+F2</strong> or choose <strong>Analyze -&gt; Performance Profiler...</strong> from the main menu to open the <strong>Analysis Target</strong> window.
            </p></li><li><p>
              Ensure that <strong>CPU Usage</strong> is the only ticked option and click <strong>Start</strong> or press <strong>Enter</strong>.
            </p></li><li><p>
              When the application has finished running, Visual Studio will after some moments display the <span class="code">Diagnostics Session</span> window. Click the link which says <span class="code">Create detailed report...</span>. This may take several minutes to run.
            </p><div class="mediaNear"><img alt="VSProfile Diagnostics" src="../media/VSProfileDiagnostics.png" /></div><div class="mediaNear"><img alt="VSProfile Sample Report" src="../media/VSProfileSampleReport.png" /></div></li><li><p>
              You will now see the <strong>Sample Profiling Report</strong> window. From the <strong>Current View</strong> drop-down, select <strong>Functions</strong>.
            </p><div class="mediaNear"><img alt="VSProfile Functions" src="../media/VSProfileFunctions.png" /></div><p>
              This window shows the amount of run-time each function used. There are two primary measurements: the <strong>Exclusive Samples %</strong> figure reports how much run-time a single function took, not including any functions it calls. This can be used to find individual functions that may be causing bottlenecks and see which functions perform the most work. The <strong>Inclusive Samples %</strong> figure reports how much run-time a single function plus all of the functions it called took. This can be used to see what higher level portions of activity are the most time-consuming.
            </p><p>
              In the example above, we can see that 68.68% of the test application's time was spent performing actions and 23.65% of the time was spent cloning. Some of those actions caused all the cloning to occur, so by deduction we can observe that running all of the actions not related to cloning consumed about 45% of the run-time.
            </p><p>
              We also see that death creation took 40% of the run-time (as part of running actions, as this is the only time the death creation step can run), which seems abnormally high. We can double-click on it to find out more.
            </p></li><li><div class="mediaNear"><img alt="VSFunction Details 1" src="../media/VSFunctionDetails1.png" /></div><p>
              When you double-click an item in the <strong>Functions</strong> view, you will be taken to the <strong>Function Details</strong> view as shown above (you can use the back arrow within the profiling report to navigate backwards and forwards). Here we see that fetching an entity's zone takes 7.8% of the entire run-time. This could mean that fetching the zone is slow, or it could simply mean that we have made a very high number of requests to fetch the <span class="code">Zone</span> property. To find out which is the case, we can click on one of the <strong>Calling functions</strong> to investigate further.
            </p><div class="mediaNear"><img alt="VSFunction Details 2" src="../media/VSFunctionDetails2.png" /></div><p>
              Here we have clicked on <span class="code">get_FuzzyGameHash</span>. We see that checking the entity's zone is in fact very slow compared to the rest of the code. Whether <span class="code">get_FuzzyGameHash</span> is called once or a million times, fetching the entity's zone (and zone position) is by far the slowest part of the function. The rest of the function is quite performant, using very little total run-time. Therfore, we can conclude in this case that fetching an entity's zone is a good candidate for optimization.
            </p></li></ol></div><div class="collapsibleAreaRegion" id="seeAlsoSection"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />See Also</span></div><div id="ID1RBSection" class="collapsibleSection"><h4 class="subHeading">Reference</h4><div class="seeAlsoStyle"><a href="cd5363d1-f7d0-3cf8-36a7-bd25916dc8c9.htm">Brimstone<span id="LSTF7554AF9_0"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTF7554AF9_0?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>Settings</a></div><h4 class="subHeading">Other Resources</h4><div class="seeAlsoStyle"><a href="3867a7e4-21e2-4e3b-934b-c1c4ae15efa9.htm">Benchmarks and Profiling</a></div><div class="seeAlsoStyle"><a href="f230a982-28b6-4fd1-b0ce-c3decd883ab4.htm">Walkthrough: Benchmarking a single build</a></div><div class="seeAlsoStyle"><a href="4b0b00d6-f9a1-4eae-b880-892eb0d513fb.htm">Walkthrough: Benchmarking a series of builds</a></div><div class="seeAlsoStyle"><a href="c5beb99b-5b2f-4287-b2e8-c787a10399eb.htm">Walkthrough: Creating new benchmarks</a></div><div class="seeAlsoStyle"><a href="https://github.com/HearthSim/BrimstoneProfiler" target="_blank">BrimstoneProfiler repository homepage</a></div></div></div></div><div id="pageFooter" class="pageFooter"><a href="http://discord.me/hearthstoneworkinggroup">Join us on Discord</a><br /><p>Hearthstone Working Group 2016 - Part of HearthSim.info</p></div></body></html>